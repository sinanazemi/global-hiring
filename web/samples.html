<!DOCTYPE html>
<html>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
  <script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.5.2/angular-resource.min.js"></script>

  <body>

    <div ng-app="myApp" ng-controller="myCtrl">

      <label for="FullName">Full Name</label>
      <input id="FullName" ng-model="Name"><br/>

      <label for="Email">Email</label>
      <input id="Email" ng-model="Email"><br/>

      <label for="cities">Select City</label>
      <select id = "cities" ng-model="SelectedCity" ng-options="city.name for city in cities">
      </select><br/>

      <label for="Phone">Phone</label>
      <input id="Phone" ng-model="Phone"><br/>

      <label for="Password">Password</label>
      <input id="Password" ng-model="Password"><br/>

      <input type='checkbox' ng-model="isStudent">student?</input><br/>


      <table>
        <tr>
          <td style="border:1px solid black">
            <label for="LanguageName">Language</label>
            <input id="LanguageName" ng-model="LanguageName"><br/>

            <div ng-repeat="profeciency in LanguageProfeciencies">

                <input type="radio" name="LanguageProfeciencyRadio" ng-model="LanguageProfeciency" value="{{profeciency.value}}">
                  {{profeciency.text}}
                </input>
                <br>
            </div>{{LanguageProfeciency}}
          </td>
          <td style="border:1px solid black">
            <button ng-click="addLanguage()">add --></button><br/>
          </td>
          <td style="border:1px solid black">
            <div ng-repeat="language in languages">
              {{language.name + "(" + language.profeciency + ")"}}<br>
            </div>
          </td>
        </tr>
      </table>

      <button ng-click="saveAccount()">save</button><br/>

      <select ng-model="selectedService" ng-options="service.name for service in services" ng-change="getSkills()">
      </select>

      <br/>

      <select ng-model="selectedSkill" ng-options="skill.name for skill in skills">
      </select>

    </div>

    <script>
      // new dependency: ngResource is included just above
      var myapp = new angular.module("myApp", ["ngResource"]);

      // inject the $resource dependency here
      myapp.controller("myCtrl",
        ["$scope", "$resource",
          function($scope , $resource)
          {
            $scope.isStudent = true
            $scope.LanguageProfeciency = "E"
            
            var cities = $resource("/cities")

            cities.query(
              function(data){
                $scope.cities = data;
              } // function(data)
            ) // service.query

            var service = $resource("/mainServices")

            service.query(
              function(data){
                $scope.services = data;
              } // function(data)
            ) // service.query

            /*
            var skill = $resource("/skills")
            $scope.getSkills = function(){
        			skill.query({'id' : $scope.selectedService.id},
                function(data){
                  $scope.skills = data;
        			  } // function(data)
              ); // newSkill.$query
        		}; // function()
            */

            $scope.getSkills = function(){
              $scope.skills = $scope.selectedService.skills;
            }; // function()

            $scope.languages = [];

          $scope.addLanguage = function() {
                var lang = {
                name: $scope.LanguageName,
                profeciency: $scope.LanguageProfeciency
              };
              $scope.languages.push(lang);
            } // $scope.addLanguage = function()

            $scope.LanguageProfeciencies = [
              {text: "Elementary", value: "E"},
              {text: "Basic", value: "B"},
              {text: "Conversational", value: "C"},
              {text: "Fluent", value: "F"},
              {text: "Native", value: "N"}
            ]

            var saveAccount = $resource("/saveAccount")

            $scope.saveAccount = function() {

              var newAccount = new saveAccount();
              newAccount.name = $scope.Name
              newAccount.email = $scope.Email
              newAccount.city = $scope.SelectedCity
              newAccount.phone = $scope.Phone
              newAccount.password = $scope.Password
              newAccount.isstudent = $scope.isStudent

              newAccount.languages = $scope.languages

              newAccount.$save(
                function(data){
                  $scope.Name = "";
                  $scope.Email = "";
                  $scope.Phone = "";
                  $scope.Password = "";
                  $scope.City = "";
                } // function(data)
            ) // saveAccount.$save
            }



          } // function($scope , $resource)
        ] // ["$scope", "$resource",
      ); // myapp.controller
    </script>
  </body>
</html>
